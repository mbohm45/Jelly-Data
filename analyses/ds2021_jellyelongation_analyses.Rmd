---
title: "Elongation Analyses"
author: "Mara Bohm"
date: "10/12/2021"
output: pdf_document
---
```{r}
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=70), tidy=TRUE)
# code above ensures no text is cut off when knit
```

# Loading in Packages and Data

```{r, results=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(patchwork)
library(car)
library(performance)
library(DHARMa)
library(fitdistrplus)
library(gamlss)
library(tidyverse)

polyp_data <- read_csv("/Users/marabohm/Github/Jelly-Data/data/ds2021_polyp_data.csv")
```


# Cleaning the Data

```{r, results=FALSE, message=FALSE, warning=FALSE}

polyp_clean <- polyp_data %>%
  rename(collection_day = 'Data collection day', 
         jar_code = 'Jar Code (ex. E1)', 
         treatment = Chemical, 
         num_elongated = 'Elongation?', 
         num_ruffled = 'Ruffled?', 
         num_asexual_buds = 'Asexual Repro?', 
         total_num = Total) %>%
  mutate(jar_code = as.factor(jar_code),
         treatment = as.factor(treatment), 
         treatment = fct_relevel(treatment, 
                                 "Control", 
                                 "Caffeine", 
                                 "Estradiol", 
                                 "Combo"))  %>%
  dplyr::select(collection_day, 
                jar_code, 
                treatment, 
                num_elongated, 
                num_ruffled, 
                num_asexual_buds, 
                total_num) 

```


# Fitting Distributions for Elongation Data

```{r, results=FALSE, message=FALSE, warning=FALSE}

fitDist(num_elongated, 
        data = polyp_clean, 
        type = "counts", 
        try.gamlss = T)
# best fit: Negative Binomial type II (AIC = 414.587)

```


# Creating The Elongation Model

```{r, message=FALSE, warning=FALSE}

mod_countwtotal_elongation <- gamlss(num_elongated ~ treatment*collection_day 
                         + re(random = ~1 | jar_code)
                         + re(random = ~1 | total_num), 
                         family = NBII(),
                         method = RS(),
                         data = polyp_clean, 
                         control = gamlss.control(n.cyc = 200))
```

```{r, message=FALSE, warning=FALSE}
histDist(polyp_clean$num_elongated, 
         "NBII", 
         density = T, 
         main = "Count Polyp Elongation Compared to Negative Binomial II Distibution",
         xlab = "Number Elongated")

# summarizing model to determine p-values:
summary(mod_countwtotal_elongation)

```