---
title: "Total Number Analyses"
author: "Mara Bohm"
date: "10/12/2021"
output: pdf_document
---
```{r}
knitr::opts_chunk$set(tidy.opts=list(width.cutoff=70), tidy=TRUE)
# code above ensures no text is cut off when knit
```

# initial setup

```{r, results=FALSE, message=FALSE, warning=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(patchwork)
library(car)
library(performance)
library(DHARMa)
library(fitdistrplus)
library(gamlss)
library(tidyverse)

polyp_data <- read_csv("/Users/marabohm/Github/Jelly-Data/data/ds2021_polyp_data.csv")
```


# fixing polyp data

```{r, results=FALSE, message=FALSE, warning=FALSE}

polyp_clean <- polyp_data %>%
  rename(collection_day = 'Data collection day', 
         jar_code = 'Jar Code (ex. E1)', 
         treatment = Chemical, 
         num_elongated = 'Elongation?', 
         num_ruffled = 'Ruffled?', 
         num_asexual_buds = 'Asexual Repro?', 
         total_num = Total) %>%
  mutate(jar_code = as.factor(jar_code),
         treatment = as.factor(treatment), 
         treatment = fct_relevel(treatment, 
                                 "Control", 
                                 "Caffeine", 
                                 "Estradiol", 
                                 "Combo"))  %>%
  dplyr::select(collection_day, 
                jar_code, 
                treatment, 
                num_elongated, 
                num_ruffled, 
                num_asexual_buds, 
                total_num) 

```


## fitting distributions for data

```{r, results=FALSE, message=FALSE, warning=FALSE}

fitDist(total_num, 
        data = polyp_clean, 
        type = "counts", 
        try.gamlss = T)
# best fit: delaporte (AIC = 436.754)

```


## creating the models with total

```{r, message=FALSE, warning=FALSE}

mod_total <- gamlss(total_num ~ treatment*collection_day 
                    + re(random = ~1 | jar_code), 
                    family = DEL(), 
                    data = polyp_clean, 
                    control = gamlss.control(n.cyc = 60))
```

```{r, message=FALSE, warning=FALSE}
histDist(polyp_clean$total_num,
         "DEL", 
         density = T, 
         main = "Count Polyp Total Compared to Delaporte Distribution",
         xlab = "Number Polyps Total")

# summarizing the model to determine p-values:
summary(mod_total)

```
